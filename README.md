# Skunk - YAML Stack Management Tool

Skunk is a CLI tool for managing YAML stacks with anchors and references. It provides functionality to find stacks, show component details, and manage your infrastructure configuration.

## Features

- List stacks defined in YAML files
- Show components in stacks with anchor resolution
- Parse YAML files with anchor references from external files
- Support for anchors defined in external files
- Recursively search directories for anchor definitions

## Installation

```bash
go get github.com/mcalhoun/skunk
```

## CLI Usage

### Configuration

Skunk uses a `skunk.yaml` configuration file in the current directory by default. You can specify a different config file using the `--config` flag.

Example `skunk.yaml`:

```yaml
stacksPath: fixtures/stacks/*.yaml
catalogDir: fixtures/catalog
maxTableWidth: 80
```

Configuration options:

- `stacksPath`: Glob pattern for finding stack YAML files
- `catalogDir`: Directory containing anchor definitions for resolving references
- `maxTableWidth`: Maximum width for tables in characters (default: 80)

### Commands

#### List Stacks

Lists all stacks that match the configured `stacksPath` glob pattern.

```bash
skunk list stacks [--json] [--no-color]
```

Options:

- `--json`: Output in JSON format instead of a table
- `--no-color`: Disable colored output, useful for scripts or terminals that don't support colors

Example output (colored table):

```
Stack Resources

Name                          Path
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
plat-prod-primary             fixtures/stacks/plat-prod-east-1.yaml
plat-prod-secondary           fixtures/stacks/plat-prod-west-1.yaml
```

#### Show Stack

Shows detailed component information for a specific stack.

```bash
skunk show stack --stackName <name> [--component <name>] [--json] [--no-color] [--tfvars]
```

Options:

- `--stackName`, `-s`: The name of the stack to show (required)
- `--component`, `-c`: The name of a specific component to show variables for
- `--json`: Output in JSON format instead of a table
- `--no-color`: Disable colored output, useful for scripts or terminals that don't support colors
- `--tfvars`: Output component variables in Terraform format (only valid with `--component`)

Example output (stack components table):

```
COMPONENTS

┌─────────────────────────────────────────────────────────────────────────────────┐
│ TYPE                             NAME                                           │
│─────────────────────────────────────────────────────────────────────────────────│
│ terraform                        vpc                                            │
└─────────────────────────────────────────────────────────────────────────────────┘
```

Example output (component variables with `--component vpc`):

```text
COMPONENT: terraform/vpc

┌─────────────────────────────────────────────────────────────────────────────────┐
│ VARIABLE                        VALUE                                           │
│─────────────────────────────────────────────────────────────────────────────────│
│ availability_zones              [us-east-1a us-east-1b us-east-1c]              │
│ dns_hostnames_enabled           true                                            │
│ dns_support_enabled             true                                            │
│ enabled                         false                                           │
│ internet_gateway_enabled        true                                            │
│ ipv4_primary_cidr_block         10.2.1.0/16                                     │
│ name                            dead-vpc                                        │
│ nat_gateway_enabled             true                                            │
│ nat_instance_enabled            false                                           │
│ region                          us-east-1                                       │
│ vpc_flow_logs_enabled           true                                            │
│ vpc_flow_logs_log_destination_type cloud-watch-logs                             │
│ vpc_flow_logs_traffic_type      ALL                                             │
└─────────────────────────────────────────────────────────────────────────────────┘
```

Example output (Terraform format with `--component vpc --tfvars`):

```hcl
# Terraform variables for component 'vpc' from stack 'plat-prod-east-1.yaml'
# Generated by skunk

availability_zones = ["us-east-1a", "us-east-1b", "us-east-1c"]
dns_hostnames_enabled = true
dns_support_enabled = true
enabled = false
internet_gateway_enabled = true
ipv4_primary_cidr_block = "10.2.1.0/16"
name = "dead-vpc"
nat_gateway_enabled = true
nat_instance_enabled = false
region = "us-east-1"
```

Example output (JSON format with `--json`):

```json
[
  {
    "type": "terraform",
    "name": "vpc"
  }
]
```

## Library Usage

Skunk can also be used as a Go library:

```go
package main

import (
	"fmt"
	"log"

	"github.com/mcalhoun/skunk/internal/stack-finder"
	yamlparser "github.com/mcalhoun/skunk/internal/yaml-parser"
)

func main() {
	// Find stacks
	stacks, err := stackfinder.FindStacks("fixtures/stacks/*.yaml")
	if err != nil {
		log.Fatalf("Error finding stacks: %v", err)
	}

	// Process each stack
	for _, stack := range stacks {
		fmt.Printf("Found stack: %s in %s\n", stack.Name, stack.FilePath)

		// Merge YAML with anchors
		mergedYAML, err := yamlparser.MergeYAML(stack.FilePath, "fixtures/catalog")
		if err != nil {
			log.Fatalf("Error merging YAML: %v", err)
		}

		fmt.Printf("Merged YAML:\n%s\n", string(mergedYAML))
	}
}
```

## License

MIT
